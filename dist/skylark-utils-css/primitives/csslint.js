/**
 * skylark-utils-css - The skylark css utility library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./parser-lib"],function(e){function t(e,t){this.messages=[],this.stats=[],this.lines=e,this.ruleset=t}var r=function(){function r(e,t){var r,n=e&&e.match(i),o=n&&n[1];return o&&(r={"true":2,"":1,"false":0,2:2,1:1,0:0},o.toLowerCase().split(",").forEach(function(e){var n=e.split(":"),o=n[0]||"",i=n[1]||"";t[o.trim()]=r[i.trim()]})),t}var n=[],o=[],i=/\/\*csslint([^\*]*)\*\//,s=new e.util.EventTarget;return s.version="0.10.0",s.addRule=function(e){n.push(e),n[e.id]=e},s.clearRules=function(){n=[]},s.getRules=function(){return[].concat(n).sort(function(e,t){return e.id>t.id?1:0})},s.getRuleset=function(){for(var e={},t=0,r=n.length;t<r;)e[n[t++].id]=1;return e},s.addFormatter=function(e){o[e.id]=e},s.getFormatter=function(e){return o[e]},s.format=function(e,t,r,n){var o=this.getFormatter(r),i=null;return o&&(i=o.startFormat(),i+=o.formatResults(e,t,n||{}),i+=o.endFormat()),i},s.hasFormat=function(e){return o.hasOwnProperty(e)},s.verify=function(o,s){var a,l,d,u=0,c=(n.length,new e.css.Parser({starHack:!0,ieFilters:!0,underscoreHack:!0,strict:!1}));l=o.replace(/\n\r?/g,"$split$").split("$split$"),s||(s=this.getRuleset()),i.test(o)&&(s=r(o,s)),a=new t(l,s),s.errors=2;for(u in s)s.hasOwnProperty(u)&&s[u]&&n[u]&&n[u].init(c,a);try{c.parse(o)}catch(p){a.error("Fatal error, cannot continue: "+p.message,p.line,p.col,{})}return d={messages:a.messages,stats:a.stats,ruleset:a.ruleset},d.messages.sort(function(e,t){return e.rollup&&!t.rollup?1:!e.rollup&&t.rollup?-1:e.line-t.line}),d},s}();return t.prototype={constructor:t,error:function(e,t,r,n){this.messages.push({type:"error",line:t,col:r,message:e,evidence:this.lines[t-1],rule:n||{}})},warn:function(e,t,r,n){this.report(e,t,r,n)},report:function(e,t,r,n){this.messages.push({type:2==this.ruleset[n.id]?"error":"warning",line:t,col:r,message:e,evidence:this.lines[t-1],rule:n})},info:function(e,t,r,n){this.messages.push({type:"info",line:t,col:r,message:e,evidence:this.lines[t-1],rule:n})},rollupError:function(e,t){this.messages.push({type:"error",rollup:!0,message:e,rule:t})},rollupWarn:function(e,t){this.messages.push({type:"warning",rollup:!0,message:e,rule:t})},stat:function(e,t){this.stats[e]=t}},r._Reporter=t,r.Util={mix:function(e,t){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return r},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},forEach:function(e,t){if(e.forEach)return e.forEach(t);for(var r=0,n=e.length;r<n;r++)t(e[r],r,e)}},r.addRule({id:"adjoining-classes",name:"Disallow adjoining classes",desc:"Don't use adjoining classes.",browsers:"IE6",init:function(e,t){var r=this;e.addListener("startrule",function(n){var o,i,s,a,l,d,u,c=n.selectors;for(l=0;l<c.length;l++)for(o=c[l],d=0;d<o.parts.length;d++)if(i=o.parts[d],i.type==e.SELECTOR_PART_TYPE)for(a=0,u=0;u<i.modifiers.length;u++)s=i.modifiers[u],"class"==s.type&&a++,a>1&&t.report("Don't use adjoining classes.",i.line,i.col,r)})}}),r.addRule({id:"box-model",name:"Beware of broken box size",desc:"Don't use width or height when using padding or border.",browsers:"All",init:function(e,t){function r(){o={},l=!1}function n(){var e,r;if(!l){if(o.height)for(e in a)a.hasOwnProperty(e)&&o[e]&&(r=o[e].value,"padding"==e&&2===r.parts.length&&0===r.parts[0].value||t.report("Using height with "+e+" can sometimes make elements larger than you expect.",o[e].line,o[e].col,i));if(o.width)for(e in s)s.hasOwnProperty(e)&&o[e]&&(r=o[e].value,"padding"==e&&2===r.parts.length&&0===r.parts[1].value||t.report("Using width with "+e+" can sometimes make elements larger than you expect.",o[e].line,o[e].col,i))}}var o,i=this,s={border:1,"border-left":1,"border-right":1,padding:1,"padding-left":1,"padding-right":1},a={border:1,"border-bottom":1,"border-top":1,padding:1,"padding-bottom":1,"padding-top":1},l=!1;e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("startpage",r),e.addListener("startpagemargin",r),e.addListener("startkeyframerule",r),e.addListener("property",function(e){var t=e.property.text.toLowerCase();a[t]||s[t]?/^0\S*$/.test(e.value)||"border"==t&&"none"==e.value||(o[t]={line:e.property.line,col:e.property.col,value:e.value}):/^(width|height)/i.test(t)&&/^(length|percentage)/.test(e.value.parts[0].type)?o[t]=1:"box-sizing"==t&&(l=!0)}),e.addListener("endrule",n),e.addListener("endfontface",n),e.addListener("endpage",n),e.addListener("endpagemargin",n),e.addListener("endkeyframerule",n)}}),r.addRule({id:"box-sizing",name:"Disallow use of box-sizing",desc:"The box-sizing properties isn't supported in IE6 and IE7.",browsers:"IE6, IE7",tags:["Compatibility"],init:function(e,t){var r=this;e.addListener("property",function(e){var n=e.property.text.toLowerCase();"box-sizing"==n&&t.report("The box-sizing property isn't supported in IE6 and IE7.",e.line,e.col,r)})}}),r.addRule({id:"bulletproof-font-face",name:"Use the bulletproof @font-face syntax",desc:"Use the bulletproof @font-face syntax to avoid 404's in old IE (http://www.fontspring.com/blog/the-new-bulletproof-font-face-syntax).",browsers:"All",init:function(e,t){var r,n,o=this,i=!1,s=!0,a=!1;e.addListener("startfontface",function(e){i=!0}),e.addListener("property",function(e){if(i){var t=e.property.toString().toLowerCase(),o=e.value.toString();if(r=e.line,n=e.col,"src"===t){var l=/^\s?url\(['"].+\.eot\?.*['"]\)\s*format\(['"]embedded-opentype['"]\).*$/i;!o.match(l)&&s?(a=!0,s=!1):o.match(l)&&!s&&(a=!1)}}}),e.addListener("endfontface",function(e){i=!1,a&&t.report("@font-face declaration doesn't follow the fontspring bulletproof syntax.",r,n,o)})}}),r.addRule({id:"compatible-vendor-prefixes",name:"Require compatible vendor prefixes",desc:"Include all compatible vendor prefixes to reach a wider range of users.",browsers:"All",init:function(e,t){var n,o,i,s,a,l,d,u=this,c=!1,p=Array.prototype.push,f=[];n={animation:"webkit moz","animation-delay":"webkit moz","animation-direction":"webkit moz","animation-duration":"webkit moz","animation-fill-mode":"webkit moz","animation-iteration-count":"webkit moz","animation-name":"webkit moz","animation-play-state":"webkit moz","animation-timing-function":"webkit moz",appearance:"webkit moz","border-end":"webkit moz","border-end-color":"webkit moz","border-end-style":"webkit moz","border-end-width":"webkit moz","border-image":"webkit moz o","border-radius":"webkit","border-start":"webkit moz","border-start-color":"webkit moz","border-start-style":"webkit moz","border-start-width":"webkit moz","box-align":"webkit moz ms","box-direction":"webkit moz ms","box-flex":"webkit moz ms","box-lines":"webkit ms","box-ordinal-group":"webkit moz ms","box-orient":"webkit moz ms","box-pack":"webkit moz ms","box-sizing":"webkit moz","box-shadow":"webkit moz","column-count":"webkit moz ms","column-gap":"webkit moz ms","column-rule":"webkit moz ms","column-rule-color":"webkit moz ms","column-rule-style":"webkit moz ms","column-rule-width":"webkit moz ms","column-width":"webkit moz ms",hyphens:"epub moz","line-break":"webkit ms","margin-end":"webkit moz","margin-start":"webkit moz","marquee-speed":"webkit wap","marquee-style":"webkit wap","padding-end":"webkit moz","padding-start":"webkit moz","tab-size":"moz o","text-size-adjust":"webkit ms",transform:"webkit moz ms o","transform-origin":"webkit moz ms o",transition:"webkit moz o","transition-delay":"webkit moz o","transition-duration":"webkit moz o","transition-property":"webkit moz o","transition-timing-function":"webkit moz o","user-modify":"webkit moz","user-select":"webkit moz ms","word-break":"epub ms","writing-mode":"epub ms"};for(i in n)if(n.hasOwnProperty(i)){for(s=[],a=n[i].split(" "),l=0,d=a.length;l<d;l++)s.push("-"+a[l]+"-"+i);n[i]=s,p.apply(f,s)}e.addListener("startrule",function(){o=[]}),e.addListener("startkeyframes",function(e){c=e.prefix||!0}),e.addListener("endkeyframes",function(e){c=!1}),e.addListener("property",function(e){var t=e.property;r.Util.indexOf(f,t.text)>-1&&(c&&"string"==typeof c&&0===t.text.indexOf("-"+c+"-")||o.push(t))}),e.addListener("endrule",function(e){if(o.length){var i,s,a,l,d,c,p,f,m,h,g={};for(i=0,s=o.length;i<s;i++){a=o[i];for(l in n)n.hasOwnProperty(l)&&(d=n[l],r.Util.indexOf(d,a.text)>-1&&(g[l]||(g[l]={full:d.slice(0),actual:[],actualNodes:[]}),r.Util.indexOf(g[l].actual,a.text)===-1&&(g[l].actual.push(a.text),g[l].actualNodes.push(a))))}for(l in g)if(g.hasOwnProperty(l)&&(c=g[l],p=c.full,f=c.actual,p.length>f.length))for(i=0,s=p.length;i<s;i++)m=p[i],r.Util.indexOf(f,m)===-1&&(h=1===f.length?f[0]:2==f.length?f.join(" and "):f.join(", "),t.report("The property "+m+" is compatible with "+h+" and should be included as well.",c.actualNodes[0].line,c.actualNodes[0].col,u))}})}}),r.addRule({id:"display-property-grouping",name:"Require properties appropriate for display",desc:"Certain properties shouldn't be used with certain display property values.",browsers:"All",init:function(e,t){function r(e,r,n){i[e]&&("string"==typeof a[e]&&i[e].value.toLowerCase()==a[e]||t.report(n||e+" can't be used with display: "+r+".",i[e].line,i[e].col,s))}function n(){i={}}function o(){var e=i.display?i.display.value:null;if(e)switch(e){case"inline":r("height",e),r("width",e),r("margin",e),r("margin-top",e),r("margin-bottom",e),r("float",e,"display:inline has no effect on floated elements (but may be used to fix the IE6 double-margin bug).");break;case"block":r("vertical-align",e);break;case"inline-block":r("float",e);break;default:0===e.indexOf("table-")&&(r("margin",e),r("margin-left",e),r("margin-right",e),r("margin-top",e),r("margin-bottom",e),r("float",e))}}var i,s=this,a={display:1,"float":"none",height:1,width:1,margin:1,"margin-left":1,"margin-right":1,"margin-bottom":1,"margin-top":1,padding:1,"padding-left":1,"padding-right":1,"padding-bottom":1,"padding-top":1,"vertical-align":1};e.addListener("startrule",n),e.addListener("startfontface",n),e.addListener("startkeyframerule",n),e.addListener("startpagemargin",n),e.addListener("startpage",n),e.addListener("property",function(e){var t=e.property.text.toLowerCase();a[t]&&(i[t]={value:e.value.text,line:e.property.line,col:e.property.col})}),e.addListener("endrule",o),e.addListener("endfontface",o),e.addListener("endkeyframerule",o),e.addListener("endpagemargin",o),e.addListener("endpage",o)}}),r.addRule({id:"duplicate-background-images",name:"Disallow duplicate background images",desc:"Every background-image should be unique. Use a common class for e.g. sprites.",browsers:"All",init:function(e,t){var r=this,n={};e.addListener("property",function(e){var o,i,s=e.property.text,a=e.value;if(s.match(/background/i))for(o=0,i=a.parts.length;o<i;o++)"uri"==a.parts[o].type&&("undefined"==typeof n[a.parts[o].uri]?n[a.parts[o].uri]=e:t.report("Background image '"+a.parts[o].uri+"' was used multiple times, first declared at line "+n[a.parts[o].uri].line+", col "+n[a.parts[o].uri].col+".",e.line,e.col,r))})}}),r.addRule({id:"duplicate-properties",name:"Disallow duplicate properties",desc:"Duplicate properties must appear one after the other.",browsers:"All",init:function(e,t){function r(e){n={}}var n,o,i=this;e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("startpage",r),e.addListener("startpagemargin",r),e.addListener("startkeyframerule",r),e.addListener("property",function(e){var r=e.property,s=r.text.toLowerCase();!n[s]||o==s&&n[s]!=e.value.text||t.report("Duplicate property '"+e.property+"' found.",e.line,e.col,i),n[s]=e.value.text,o=s})}}),r.addRule({id:"empty-rules",name:"Disallow empty rules",desc:"Rules without any properties specified should be removed.",browsers:"All",init:function(e,t){var r=this,n=0;e.addListener("startrule",function(){n=0}),e.addListener("property",function(){n++}),e.addListener("endrule",function(e){var o=e.selectors;0===n&&t.report("Rule is empty.",o[0].line,o[0].col,r)})}}),r.addRule({id:"errors",name:"Parsing Errors",desc:"This rule looks for recoverable syntax errors.",browsers:"All",init:function(e,t){var r=this;e.addListener("error",function(e){t.error(e.message,e.line,e.col,r)})}}),r.addRule({id:"fallback-colors",name:"Require fallback colors",desc:"For older browsers that don't support RGBA, HSL, or HSLA, provide a fallback color.",browsers:"IE6,IE7,IE8",init:function(e,t){function r(e){o={},n=null}var n,o,i=this,s={color:1,background:1,"border-color":1,"border-top-color":1,"border-right-color":1,"border-bottom-color":1,"border-left-color":1,border:1,"border-top":1,"border-right":1,"border-bottom":1,"border-left":1,"background-color":1};e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("startpage",r),e.addListener("startpagemargin",r),e.addListener("startkeyframerule",r),e.addListener("property",function(e){var r=e.property,o=r.text.toLowerCase(),a=e.value.parts,l=0,d="",u=a.length;if(s[o])for(;l<u;)"color"==a[l].type&&("alpha"in a[l]||"hue"in a[l]?(/([^\)]+)\(/.test(a[l])&&(d=RegExp.$1.toUpperCase()),n&&n.property.text.toLowerCase()==o&&"compat"==n.colorType||t.report("Fallback "+o+" (hex or RGB) should precede "+d+" "+o+".",e.line,e.col,i)):e.colorType="compat"),l++;n=e})}}),r.addRule({id:"floats",name:"Disallow too many floats",desc:"This rule tests if the float property is used too many times",browsers:"All",init:function(e,t){var r=this,n=0;e.addListener("property",function(e){"float"==e.property.text.toLowerCase()&&"none"!=e.value.text.toLowerCase()&&n++}),e.addListener("endstylesheet",function(){t.stat("floats",n),n>=10&&t.rollupWarn("Too many floats ("+n+"), you're probably using them for layout. Consider using a grid system instead.",r)})}}),r.addRule({id:"font-faces",name:"Don't use too many web fonts",desc:"Too many different web fonts in the same stylesheet.",browsers:"All",init:function(e,t){var r=this,n=0;e.addListener("startfontface",function(){n++}),e.addListener("endstylesheet",function(){n>5&&t.rollupWarn("Too many @font-face declarations ("+n+").",r)})}}),r.addRule({id:"font-sizes",name:"Disallow too many font sizes",desc:"Checks the number of font-size declarations.",browsers:"All",init:function(e,t){var r=this,n=0;e.addListener("property",function(e){"font-size"==e.property&&n++}),e.addListener("endstylesheet",function(){t.stat("font-sizes",n),n>=10&&t.rollupWarn("Too many font-size declarations ("+n+"), abstraction needed.",r)})}}),r.addRule({id:"gradients",name:"Require all gradient definitions",desc:"When using a vendor-prefixed gradient, make sure to use them all.",browsers:"All",init:function(e,t){var r,n=this;e.addListener("startrule",function(){r={moz:0,webkit:0,oldWebkit:0,o:0}}),e.addListener("property",function(e){/\-(moz|o|webkit)(?:\-(?:linear|radial))\-gradient/i.test(e.value)?r[RegExp.$1]=1:/\-webkit\-gradient/i.test(e.value)&&(r.oldWebkit=1)}),e.addListener("endrule",function(e){var o=[];r.moz||o.push("Firefox 3.6+"),r.webkit||o.push("Webkit (Safari 5+, Chrome)"),r.oldWebkit||o.push("Old Webkit (Safari 4+, Chrome)"),r.o||o.push("Opera 11.1+"),o.length&&o.length<4&&t.report("Missing vendor-prefixed CSS gradients for "+o.join(", ")+".",e.selectors[0].line,e.selectors[0].col,n)})}}),r.addRule({id:"ids",name:"Disallow IDs in selectors",desc:"Selectors should not contain IDs.",browsers:"All",init:function(e,t){var r=this;e.addListener("startrule",function(n){var o,i,s,a,l,d,u,c=n.selectors;for(l=0;l<c.length;l++){for(o=c[l],a=0,d=0;d<o.parts.length;d++)if(i=o.parts[d],i.type==e.SELECTOR_PART_TYPE)for(u=0;u<i.modifiers.length;u++)s=i.modifiers[u],"id"==s.type&&a++;1==a?t.report("Don't use IDs in selectors.",o.line,o.col,r):a>1&&t.report(a+" IDs in the selector, really?",o.line,o.col,r)}})}}),r.addRule({id:"import",name:"Disallow @import",desc:"Don't use @import, use <link> instead.",browsers:"All",init:function(e,t){var r=this;e.addListener("import",function(e){t.report("@import prevents parallel downloads, use <link> instead.",e.line,e.col,r)})}}),r.addRule({id:"important",name:"Disallow !important",desc:"Be careful when using !important declaration",browsers:"All",init:function(e,t){var r=this,n=0;e.addListener("property",function(e){e.important===!0&&(n++,t.report("Use of !important",e.line,e.col,r))}),e.addListener("endstylesheet",function(){t.stat("important",n),n>=10&&t.rollupWarn("Too many !important declarations ("+n+"), try to use less than 10 to avoid specificity issues.",r)})}}),r.addRule({id:"known-properties",name:"Require use of known properties",desc:"Properties should be known (listed in CSS3 specification) or be a vendor-prefixed property.",browsers:"All",init:function(e,t){var r=this;e.addListener("property",function(e){e.property.text.toLowerCase();e.invalid&&t.report(e.invalid.message,e.line,e.col,r)})}}),r.addRule({id:"outline-none",name:"Disallow outline: none",desc:"Use of outline: none or outline: 0 should be limited to :focus rules.",browsers:"All",tags:["Accessibility"],init:function(e,t){function r(e){o=e.selectors?{line:e.line,col:e.col,selectors:e.selectors,propCount:0,outline:!1}:null}function n(e){o&&o.outline&&(o.selectors.toString().toLowerCase().indexOf(":focus")==-1?t.report("Outlines should only be modified using :focus.",o.line,o.col,i):1==o.propCount&&t.report("Outlines shouldn't be hidden unless other visual changes are made.",o.line,o.col,i))}var o,i=this;e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("startpage",r),e.addListener("startpagemargin",r),e.addListener("startkeyframerule",r),e.addListener("property",function(e){var t=e.property.text.toLowerCase(),r=e.value;o&&(o.propCount++,"outline"!=t||"none"!=r&&"0"!=r||(o.outline=!0))}),e.addListener("endrule",n),e.addListener("endfontface",n),e.addListener("endpage",n),e.addListener("endpagemargin",n),e.addListener("endkeyframerule",n)}}),r.addRule({id:"overqualified-elements",name:"Disallow overqualified elements",desc:"Don't use classes or IDs with elements (a.foo or a#foo).",browsers:"All",init:function(e,t){var r=this,n={};e.addListener("startrule",function(o){var i,s,a,l,d,u,c=o.selectors;for(l=0;l<c.length;l++)for(i=c[l],d=0;d<i.parts.length;d++)if(s=i.parts[d],s.type==e.SELECTOR_PART_TYPE)for(u=0;u<s.modifiers.length;u++)a=s.modifiers[u],s.elementName&&"id"==a.type?t.report("Element ("+s+") is overqualified, just use "+a+" without element name.",s.line,s.col,r):"class"==a.type&&(n[a]||(n[a]=[]),n[a].push({modifier:a,part:s}))}),e.addListener("endstylesheet",function(){var e;for(e in n)n.hasOwnProperty(e)&&1==n[e].length&&n[e][0].part.elementName&&t.report("Element ("+n[e][0].part+") is overqualified, just use "+n[e][0].modifier+" without element name.",n[e][0].part.line,n[e][0].part.col,r)})}}),r.addRule({id:"qualified-headings",name:"Disallow qualified headings",desc:"Headings should not be qualified (namespaced).",browsers:"All",init:function(e,t){var r=this;e.addListener("startrule",function(n){var o,i,s,a,l=n.selectors;for(s=0;s<l.length;s++)for(o=l[s],a=0;a<o.parts.length;a++)i=o.parts[a],i.type==e.SELECTOR_PART_TYPE&&i.elementName&&/h[1-6]/.test(i.elementName.toString())&&a>0&&t.report("Heading ("+i.elementName+") should not be qualified.",i.line,i.col,r)})}}),r.addRule({id:"regex-selectors",name:"Disallow selectors that look like regexs",desc:"Selectors that look like regular expressions are slow and should be avoided.",browsers:"All",init:function(e,t){var r=this;e.addListener("startrule",function(n){var o,i,s,a,l,d,u=n.selectors;for(a=0;a<u.length;a++)for(o=u[a],l=0;l<o.parts.length;l++)if(i=o.parts[l],i.type==e.SELECTOR_PART_TYPE)for(d=0;d<i.modifiers.length;d++)s=i.modifiers[d],"attribute"==s.type&&/([\~\|\^\$\*]=)/.test(s)&&t.report("Attribute selectors with "+RegExp.$1+" are slow!",s.line,s.col,r)})}}),r.addRule({id:"rules-count",name:"Rules Count",desc:"Track how many rules there are.",browsers:"All",init:function(e,t){var r=0;e.addListener("startrule",function(){r++}),e.addListener("endstylesheet",function(){t.stat("rule-count",r)})}}),r.addRule({id:"selector-max-approaching",name:"Warn when approaching the 4095 selector limit for IE",desc:"Will warn when selector count is >= 3800 selectors.",browsers:"IE",init:function(e,t){var r=this,n=0;e.addListener("startrule",function(e){n+=e.selectors.length}),e.addListener("endstylesheet",function(){n>=3800&&t.report("You have "+n+" selectors. Internet Explorer supports a maximum of 4095 selectors per stylesheet. Consider refactoring.",0,0,r)})}}),r.addRule({id:"selector-max",name:"Error when past the 4095 selector limit for IE",desc:"Will error when selector count is > 4095.",browsers:"IE",init:function(e,t){var r=this,n=0;e.addListener("startrule",function(e){n+=e.selectors.length}),e.addListener("endstylesheet",function(){n>4095&&t.report("You have "+n+" selectors. Internet Explorer supports a maximum of 4095 selectors per stylesheet. Consider refactoring.",0,0,r)})}}),r.addRule({id:"shorthand",name:"Require shorthand properties",desc:"Use shorthand properties where possible.",browsers:"All",init:function(e,t){function r(e){a={}}function n(e){var r,n,o,i;for(r in u)if(u.hasOwnProperty(r)){for(i=0,n=0,o=u[r].length;n<o;n++)i+=a[u[r][n]]?1:0;i==u[r].length&&t.report("The properties "+u[r].join(", ")+" can be replaced by "+r+".",e.line,e.col,l)}}var o,i,s,a,l=this,d={},u={margin:["margin-top","margin-bottom","margin-left","margin-right"],padding:["padding-top","padding-bottom","padding-left","padding-right"]};for(o in u)if(u.hasOwnProperty(o))for(i=0,s=u[o].length;i<s;i++)d[u[o][i]]=o;e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("property",function(e){var t=e.property.toString().toLowerCase();e.value.parts[0].value;d[t]&&(a[t]=1)}),e.addListener("endrule",n),e.addListener("endfontface",n)}}),r.addRule({id:"star-property-hack",name:"Disallow properties with a star prefix",desc:"Checks for the star property hack (targets IE6/7)",browsers:"All",init:function(e,t){var r=this;e.addListener("property",function(e){var n=e.property;"*"==n.hack&&t.report("Property with star prefix found.",e.property.line,e.property.col,r)})}}),r.addRule({id:"text-indent",name:"Disallow negative text-indent",desc:"Checks for text indent less than -99px",browsers:"All",init:function(e,t){function r(e){o=!1,i="inherit"}function n(e){o&&"ltr"!=i&&t.report("Negative text-indent doesn't work well with RTL. If you use text-indent for image replacement explicitly set direction for that item to ltr.",o.line,o.col,s)}var o,i,s=this;e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("property",function(e){var t=e.property.toString().toLowerCase(),r=e.value;"text-indent"==t&&r.parts[0].value<-99?o=e.property:"direction"==t&&"ltr"==r&&(i="ltr")}),e.addListener("endrule",n),e.addListener("endfontface",n)}}),r.addRule({id:"underscore-property-hack",name:"Disallow properties with an underscore prefix",desc:"Checks for the underscore property hack (targets IE6)",browsers:"All",init:function(e,t){var r=this;e.addListener("property",function(e){var n=e.property;"_"==n.hack&&t.report("Property with underscore prefix found.",e.property.line,e.property.col,r)})}}),r.addRule({id:"unique-headings",name:"Headings should only be defined once",desc:"Headings should be defined only once.",browsers:"All",init:function(e,t){var r=this,n={h1:0,h2:0,h3:0,h4:0,h5:0,h6:0};e.addListener("startrule",function(e){var o,i,s,a,l,d=e.selectors;for(a=0;a<d.length;a++)if(o=d[a],i=o.parts[o.parts.length-1],i.elementName&&/(h[1-6])/i.test(i.elementName.toString())){for(l=0;l<i.modifiers.length;l++)if("pseudo"==i.modifiers[l].type){s=!0;break}s||(n[RegExp.$1]++,n[RegExp.$1]>1&&t.report("Heading ("+i.elementName+") has already been defined.",i.line,i.col,r))}}),e.addListener("endstylesheet",function(e){var o,i=[];for(o in n)n.hasOwnProperty(o)&&n[o]>1&&i.push(n[o]+" "+o+"s");i.length&&t.rollupWarn("You have "+i.join(", ")+" defined in this stylesheet.",r)})}}),r.addRule({id:"universal-selector",name:"Disallow universal selector",desc:"The universal selector (*) is known to be slow.",browsers:"All",init:function(e,t){var r=this;e.addListener("startrule",function(e){var n,o,i,s=e.selectors;for(i=0;i<s.length;i++)n=s[i],o=n.parts[n.parts.length-1],"*"==o.elementName&&t.report(r.desc,o.line,o.col,r)})}}),r.addRule({id:"unqualified-attributes",name:"Disallow unqualified attribute selectors",desc:"Unqualified attribute selectors are known to be slow.",browsers:"All",init:function(e,t){var r=this;e.addListener("startrule",function(n){var o,i,s,a,l,d=n.selectors;for(a=0;a<d.length;a++)if(o=d[a],i=o.parts[o.parts.length-1],i.type==e.SELECTOR_PART_TYPE)for(l=0;l<i.modifiers.length;l++)s=i.modifiers[l],"attribute"!=s.type||i.elementName&&"*"!=i.elementName||t.report(r.desc,i.line,i.col,r)})}}),r.addRule({id:"vendor-prefix",name:"Require standard property with vendor prefix",desc:"When using a vendor-prefixed property, make sure to include the standard one.",browsers:"All",init:function(e,t){function r(){o={},i=1}function n(e){var r,n,i,l,d,u=[];for(r in o)a[r]&&u.push({actual:r,needed:a[r]});for(n=0,i=u.length;n<i;n++)l=u[n].needed,d=u[n].actual,o[l]?o[l][0].pos<o[d][0].pos&&t.report("Standard property '"+l+"' should come after vendor-prefixed property '"+d+"'.",o[d][0].name.line,o[d][0].name.col,s):t.report("Missing standard property '"+l+"' to go along with '"+d+"'.",o[d][0].name.line,o[d][0].name.col,s)}var o,i,s=this,a={"-webkit-border-radius":"border-radius","-webkit-border-top-left-radius":"border-top-left-radius","-webkit-border-top-right-radius":"border-top-right-radius","-webkit-border-bottom-left-radius":"border-bottom-left-radius","-webkit-border-bottom-right-radius":"border-bottom-right-radius","-o-border-radius":"border-radius","-o-border-top-left-radius":"border-top-left-radius","-o-border-top-right-radius":"border-top-right-radius","-o-border-bottom-left-radius":"border-bottom-left-radius","-o-border-bottom-right-radius":"border-bottom-right-radius","-moz-border-radius":"border-radius","-moz-border-radius-topleft":"border-top-left-radius","-moz-border-radius-topright":"border-top-right-radius","-moz-border-radius-bottomleft":"border-bottom-left-radius","-moz-border-radius-bottomright":"border-bottom-right-radius","-moz-column-count":"column-count","-webkit-column-count":"column-count","-moz-column-gap":"column-gap","-webkit-column-gap":"column-gap","-moz-column-rule":"column-rule","-webkit-column-rule":"column-rule","-moz-column-rule-style":"column-rule-style","-webkit-column-rule-style":"column-rule-style","-moz-column-rule-color":"column-rule-color","-webkit-column-rule-color":"column-rule-color","-moz-column-rule-width":"column-rule-width","-webkit-column-rule-width":"column-rule-width","-moz-column-width":"column-width","-webkit-column-width":"column-width","-webkit-column-span":"column-span","-webkit-columns":"columns","-moz-box-shadow":"box-shadow","-webkit-box-shadow":"box-shadow","-moz-transform":"transform","-webkit-transform":"transform","-o-transform":"transform","-ms-transform":"transform","-moz-transform-origin":"transform-origin","-webkit-transform-origin":"transform-origin","-o-transform-origin":"transform-origin","-ms-transform-origin":"transform-origin","-moz-box-sizing":"box-sizing","-webkit-box-sizing":"box-sizing","-moz-user-select":"user-select","-khtml-user-select":"user-select","-webkit-user-select":"user-select"};e.addListener("startrule",r),e.addListener("startfontface",r),e.addListener("startpage",r),e.addListener("startpagemargin",r),e.addListener("startkeyframerule",r),e.addListener("property",function(e){var t=e.property.text.toLowerCase();o[t]||(o[t]=[]),o[t].push({name:e.property,value:e.value,pos:i++})}),e.addListener("endrule",n),e.addListener("endfontface",n),e.addListener("endpage",n),e.addListener("endpagemargin",n),e.addListener("endkeyframerule",n)}}),r.addRule({id:"zero-units",name:"Disallow units for 0 values",desc:"You don't need to specify units when a value is 0.",browsers:"All",init:function(e,t){var r=this;e.addListener("property",function(e){for(var n=e.value.parts,o=0,i=n.length;o<i;)!n[o].units&&"percentage"!=n[o].type||0!==n[o].value||"time"==n[o].type||t.report("Values of 0 shouldn't have units specified.",n[o].line,n[o].col,r),o++})}}),function(){var e=function(e){return e&&e.constructor===String?e.replace(/[\"&><]/g,function(e){switch(e){case'"':return"&quot;";case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;"}}):""};r.addFormatter({id:"checkstyle-xml",name:"Checkstyle XML format",startFormat:function(){return'<?xml version="1.0" encoding="utf-8"?><checkstyle>'},endFormat:function(){return"</checkstyle>"},readError:function(t,r){return'<file name="'+e(t)+'"><error line="0" column="0" severty="error" message="'+e(r)+'"></error></file>'},formatResults:function(t,n,o){var i=t.messages,s=[],a=function(e){return e&&"name"in e?"net.csslint."+e.name.replace(/\s/g,""):""};return i.length>0&&(s.push('<file name="'+n+'">'),r.Util.forEach(i,function(t,r){t.rollup||s.push('<error line="'+t.line+'" column="'+t.col+'" severity="'+t.type+'" message="'+e(t.message)+'" source="'+a(t.rule)+'"/>')}),s.push("</file>")),s.join("")}})}(),r.addFormatter({id:"compact",name:"Compact, 'porcelain' format",startFormat:function(){return""},endFormat:function(){return""},formatResults:function(e,t,n){var o=e.messages,i="";n=n||{};var s=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};return 0===o.length?n.quiet?"":t+": Lint Free!":(r.Util.forEach(o,function(e,r){i+=e.rollup?t+": "+s(e.type)+" - "+e.message+"\n":t+": line "+e.line+", col "+e.col+", "+s(e.type)+" - "+e.message+"\n"}),i)}}),r.addFormatter({id:"csslint-xml",name:"CSSLint XML format",startFormat:function(){return'<?xml version="1.0" encoding="utf-8"?><csslint>'},endFormat:function(){return"</csslint>"},formatResults:function(e,t,n){var o=e.messages,i=[],s=function(e){return e&&e.constructor===String?e.replace(/\"/g,"'").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""};return o.length>0&&(i.push('<file name="'+t+'">'),r.Util.forEach(o,function(e,t){e.rollup?i.push('<issue severity="'+e.type+'" reason="'+s(e.message)+'" evidence="'+s(e.evidence)+'"/>'):i.push('<issue line="'+e.line+'" char="'+e.col+'" severity="'+e.type+'" reason="'+s(e.message)+'" evidence="'+s(e.evidence)+'"/>')}),i.push("</file>")),i.join("")}}),r.addFormatter({id:"junit-xml",name:"JUNIT XML format",startFormat:function(){return'<?xml version="1.0" encoding="utf-8"?><testsuites>'},endFormat:function(){return"</testsuites>"},formatResults:function(e,t,r){var n=e.messages,o=[],i={error:0,failure:0},s=function(e){return e&&"name"in e?"net.csslint."+e.name.replace(/\s/g,""):""},a=function(e){return e&&e.constructor===String?e.replace(/\"/g,"'").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""};return n.length>0&&(n.forEach(function(e,t){var r="warning"===e.type?"error":e.type;e.rollup||(o.push('<testcase time="0" name="'+s(e.rule)+'">'),o.push("<"+r+' message="'+a(e.message)+'"><![CDATA['+e.line+":"+e.col+":"+a(e.evidence)+"]]></"+r+">"),o.push("</testcase>"),i[r]+=1)}),o.unshift('<testsuite time="0" tests="'+n.length+'" skipped="0" errors="'+i.error+'" failures="'+i.failure+'" package="net.csslint" name="'+t+'">'),o.push("</testsuite>")),o.join("")}}),r.addFormatter({id:"lint-xml",name:"Lint XML format",startFormat:function(){return'<?xml version="1.0" encoding="utf-8"?><lint>'},endFormat:function(){return"</lint>"},formatResults:function(e,t,n){var o=e.messages,i=[],s=function(e){return e&&e.constructor===String?e.replace(/\"/g,"'").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""};return o.length>0&&(i.push('<file name="'+t+'">'),r.Util.forEach(o,function(e,t){e.rollup?i.push('<issue severity="'+e.type+'" reason="'+s(e.message)+'" evidence="'+s(e.evidence)+'"/>'):i.push('<issue line="'+e.line+'" char="'+e.col+'" severity="'+e.type+'" reason="'+s(e.message)+'" evidence="'+s(e.evidence)+'"/>')}),i.push("</file>")),i.join("")}}),r.addFormatter({id:"text",name:"Plain Text",startFormat:function(){return""},endFormat:function(){return""},formatResults:function(e,t,n){var o=e.messages,i="";if(n=n||{},0===o.length)return n.quiet?"":"\n\ncsslint: No errors in "+t+".";
i="\n\ncsslint: There are "+o.length+" problems in "+t+".";var s=t.lastIndexOf("/"),a=t;return s===-1&&(s=t.lastIndexOf("\\")),s>-1&&(a=t.substring(s+1)),r.Util.forEach(o,function(e,t){i=i+"\n\n"+a,e.rollup?(i+="\n"+(t+1)+": "+e.type,i+="\n"+e.message):(i+="\n"+(t+1)+": "+e.type+" at line "+e.line+", col "+e.col,i+="\n"+e.message,i+="\n"+e.evidence)}),i}}),r});
//# sourceMappingURL=../sourcemaps/primitives/csslint.js.map
